# פורמטים של בנקים ישראליים וכרטיסי אשראי

## זיהוי אוטומטי של מקור הקובץ

לזהות את המקור לפי סדר עדיפות:
1. שם הקובץ (לעיתים מכיל את שם הבנק)
2. שמות עמודות (ראה טבלאות למטה)
3. שם גיליון ב-Excel
4. מבנה הנתונים ותבניות ייחודיות

אם לא ניתן לזהות → לשאול את המשתמש.

---

## בנקים

### בנק הפועלים
**עמודות נפוצות:** `תאריך`, `תאריך ערך`, `תיאור`, `אסמכתא`, `חובה`, `זכות`, `יתרה`
**וריאציות:** לפעמים `סכום חיוב` ו-`סכום זיכוי` במקום `חובה`/`זכות`
**פורמט תאריך:** DD/MM/YYYY או DD/MM/YY
**מיפוי:**
```
date → תאריך
description → תיאור
expense → חובה / סכום חיוב (שלילי)
income → זכות / סכום זיכוי (חיובי)
balance → יתרה
```

### בנק לאומי
**עמודות נפוצות:** `תאריך`, `תיאור הפעולה`, `חובה`, `זכות`, `יתרה לאחר פעולה`
**וריאציות:** `מספר אסמכתא`, `סוג פעולה`
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך
description → תיאור הפעולה
expense → חובה (שלילי)
income → זכות (חיובי)
balance → יתרה לאחר פעולה
```

### בנק דיסקונט
**עמודות נפוצות:** `תאריך פעולה`, `תאריך ערך`, `פרטים`, `חובה`, `זכות`, `יתרה`
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך פעולה
description → פרטים
expense → חובה (שלילי)
income → זכות (חיובי)
balance → יתרה
```

### בנק מזרחי טפחות
**עמודות נפוצות:** `תאריך`, `תאריך ערך`, `תיאור`, `סכום`, `יתרה`
**הערה:** עמודת `סכום` אחת - שלילי=הוצאה, חיובי=הכנסה
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך
description → תיאור
amount → סכום (כולל סימן)
balance → יתרה
```

### הבנק הבינלאומי (FIBI)
**עמודות נפוצות:** `תאריך`, `ערך`, `פרטי הפעולה`, `חובה`, `זכות`, `יתרה`
**מיפוי:** דומה לדיסקונט

### בנק ירושלים / וואן זירו
**עמודות:** משתנה, לרוב דומה לפורמט פועלים
**מיפוי:** לנסות זיהוי עמודות גנרי

---

## כרטיסי אשראי

### ויזה כאל (Visa Cal)
**עמודות נפוצות:** `תאריך עסקה`, `שם בית העסק`, `קטגוריה`, `סכום עסקה`, `סכום חיוב`, `מטבע`, `סוג עסקה`, `הערות`
**הערה:** כולל לפעמים עמודת `קטגוריה` מובנית
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך עסקה
description → שם בית העסק
amount → סכום חיוב (תמיד שלילי/הוצאה)
category_hint → קטגוריה (אם קיים)
```

### ישראכארט (Isracard)
**עמודות נפוצות:** `תאריך`, `שם בית עסק`, `סכום`, `סכום חיוב`, `מטבע`, `4 ספרות אחרונות`
**וריאציות:** `קוד קטגוריה`, `מספר תשלום מתוך`
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך
description → שם בית עסק
amount → סכום חיוב
installment → מספר תשלום מתוך (אם קיים)
```

### מקס (Max / לאומי קארד)
**עמודות נפוצות:** `תאריך עסקה`, `תאריך חיוב`, `שם בית עסק`, `סכום מקורי`, `סכום חיוב`, `מטבע מקורי`
**פורמט תאריך:** DD/MM/YYYY
**מיפוי:**
```
date → תאריך עסקה
description → שם בית עסק
amount → סכום חיוב
original_amount → סכום מקורי (לעסקאות במט"ח)
```

---

## כללי פרסור משותפים

### ניקוי סכומים
```python
def clean_amount(val):
    """המרת ערך סכום ישראלי ל-float"""
    if pd.isna(val) or val == '' or val == '-':
        return 0.0
    s = str(val).replace('₪', '').replace(',', '').replace(' ', '').strip()
    # טיפול בסוגריים (מציינים שלילי בחלק מהבנקים)
    if s.startswith('(') and s.endswith(')'):
        s = '-' + s[1:-1]
    return float(s)
```

### ניקוי תאריכים
```python
def parse_date(val):
    """המרת תאריך ישראלי ל-datetime"""
    s = str(val).strip()
    for fmt in ['%d/%m/%Y', '%d/%m/%y', '%d-%m-%Y', '%d-%m-%y', '%d.%m.%Y', '%d.%m.%y']:
        try:
            return pd.to_datetime(s, format=fmt)
        except:
            continue
    return pd.to_datetime(s, dayfirst=True)
```

### זיהוי גנרי של עמודות
אם הפורמט לא מזוהה, לחפש עמודות לפי מילות מפתח:
- **תאריך:** `תאריך`, `date`, `תאריך פעולה`, `תאריך עסקה`
- **תיאור:** `תיאור`, `פרטים`, `שם בית`, `description`
- **סכום הוצאה:** `חובה`, `חיוב`, `סכום חיוב`, `debit`
- **סכום הכנסה:** `זכות`, `זיכוי`, `credit`
- **סכום משולב:** `סכום`, `amount`
- **יתרה:** `יתרה`, `balance`
